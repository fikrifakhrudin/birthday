<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday Combined Animation</title>

    <link rel="stylesheet" href="https://public.codepenassets.com/css/normalize-5.0.0.min.css">
    <link rel="stylesheet" href="https://unpkg.com/splitting/dist/splitting.css">
    
    <style>
        /* CSS Variabel untuk Animasi Kue */
        * {
          box-sizing: border-box;
        }
        :root {
          --tongue: #c12115;
          --pupil: #fff;
          --icing: #f2f2f2;
          --stroke: #1a1a1a;
        }

        /* Merged & Modified Body Styles (Mengambil latar belakang gelap dari Musik) */
        @import url(https://fonts.googleapis.com/css?family=Raleway:400,500,300,600,700,800); /* */
        body {
            /* Music Body Styles */
            height: 100vh;
            background-image: radial-gradient(#374566, #010203);
            color: #ccc;
            font-family: Raleway;
            letter-spacing: 0.15em;
            font-size: 20px;
            
            /* Animation Body Styles (digunakan untuk flexbox centering) */
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;

            /* Animation CSS Variables */
            --frosting: hsl(var(--frosting-hue, 0), 100%, 55%);
            --lightness: 50;
            --flame: 0;
            --glow-hue: 40;
            --glow-saturation: 50;
            --glow-lightness: 35;
            --glow-alpha: 0.4;
            --transparency-alpha: 0;
            --glow: hsla(var(--glow-hue), calc(var(--glow-saturation) * 1%), calc(var(--glow-lightness) * 1%), var(--glow-alpha));
            --transparent: hsla(0, 0%, 0%, var(--transparency-alpha));
        }
        
        /* New Container for Responsive Layout */
        #main-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 40px;
            width: 90%;
            max-width: 800px;
        }

        /* Music Styles */
        canvas {
          position: absolute;
          z-index: -1;
          top: 0;
        }
        #wishes {
          width: 20em;
          margin: 0; /* Override fixed margin to work with flexbox */
          border: 1px dotted;
          text-align: center;
          background: hsla(210, 50%, 15%, 0.75);
        }
        span {
          display: inline-block;
        }
        span.jump {
          animation: jump 0.25s cubic-bezier(0.68, -0.55, 0.265, 1.55) 0s 2 alternate;
        }
        @keyframes jump {
          to {
            transform: translateY(-0.7em);
          }
        }
        #pleaseClick {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            background: hsla(210, 50%, 15%, 0.75);
            font-size: 80%;
            width: 10em;
            text-align: center;
            animation: jump 1s ease-in-out infinite alternate;
        }
        #pleaseClick span {
          font-size: 200%;
        }
        .control {
          text-align: center;
        }
        /* ... (Styling untuk input range dihilangkan untuk brevity, tapi harus disertakan) ... */


        /* Animation Styles */
        .whitespace {
          width: 7px;
        }
        .birthday-button {
          position: relative;
          transform: scale(0.6);
          cursor: pointer;
        }
        .birthday-button__text {
          position: absolute;
          top: 0;
          left: 50%;
          transform: translateX(-50%);
          white-space: nowrap;
          font-size: 30px;
          color: var(--stroke);
          letter-spacing: 0;
          font-family: Raleway; /* Use Raleway from music part */
          font-weight: 800;
          line-height: 100px;
        }
        .birthday-button__button {
          width: 240px;
          height: 100px;
          position: relative;
          border: 0;
          background: var(--icing);
          border-radius: 14px;
          cursor: pointer;
        }
        .birthday-button__cake {
          position: absolute;
          bottom: 0;
          left: 50%;
          transform: translate(-50%, 0);
          width: 289.5px;
          display: none;
        }
        /* ... (sisa styling kue, api, dll. harus disertakan di sini) ... */

        /* Media Query for Responsiveness (Tablet/Desktop) */
        @media (min-width: 768px) {
            #main-container {
                flex-direction: row; /* Bersebelahan */
                justify-content: space-around;
                align-items: center;
            }
        }
    </style>
</head>

<body>
    <canvas id="canvas"></canvas>

    <div id="main-container">
        <div id="wishes">
          <p id="p1"></p>
          <p id="p2"></p>
          <p id="p3"></p>
          <p id="p4"></p>
          <p class="control">
            <label for="inputSpeed">Speed:</label><br>
            <input type="range" id="inputSpeed" min="0.1" max="2" step="0.1" value="0.5">
          </p>
        </div>

        <div class="birthday-button">
          <button class="birthday-button__button">
            <svg class="birthday-button__cake" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 76.609 47.643">
                </svg>
            <span class="birthday-button__text" data-splitting="">Happy Birthday!</span>
          </button>
          <input id="volume" type="checkbox"/>
          <label for="volume" title="Toggle sound">
            <svg viewBox="0 0 24 24">
              <path d="M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.84 14,18.7V20.77C18,19.86 21,16.28 21,12C21,7.72 18,4.14 14,3.23M16.5,12C16.5,10.23 15.5,8.71 14,7.97V16C15.5,15.29 16.5,13.76 16.5,12M3,9V15H7L12,20V4L7,9H3Z"></path>
            </svg>
            <svg viewBox="0 0 24 24">
              <path d="M12,4L7,9H3V15H7L12,20V4M14.07,5.19L16.24,7.36C16.87,7.99 17.13,8.77 17.13,9.58C17.13,10.39 16.87,11.17 16.24,11.8L17.77,13.33C18.67,12.43 19.13,11.09 19.13,9.58C19.13,8.07 18.67,6.73 17.77,5.83L16.24,4.3C15.34,3.4 14.07,2.94 12.56,2.94C11.05,2.94 9.78,3.4 8.88,4.3L10.41,5.83C11.04,5.19 11.82,4.94 12.63,4.94C13.44,4.94 14.22,5.19 14.85,5.82L14.07,5.19Z"></path>
              <path d="M3,2.83L1.39,4.44L3,6.05L5.75,8.8L7.04,10.09L8.33,11.38L10.04,13.09L11.75,14.8L12.03,15.08L14.24,17.29L16.45,19.5L17.89,20.94L19.5,19.33L17.89,17.72L16.28,16.11L14.57,14.4L13.28,13.11L11.99,11.82L9.78,9.61L8.34,8.17L6.63,6.46L4.7,4.53L3.1,2.93L3,2.83Z"></path>
            </svg>
          </label>
        </div>
    </div>
    
    <div id="pleaseClick">Please click here<br><span>&#9759;</span></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://unpkg.com/splitting/dist/splitting.min.js"></script>

    <script>
        
        // =======================================================
        // 1. MUSICAL BIRTHDAY WISH SCRIPT
        // =======================================================

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        const p1 = document.getElementById('p1');
        const p2 = document.getElementById('p2');
        const p3 = document.getElementById('p3');
        const p4 = document.getElementById('p4');

        const notes = [
          {f:262,d:.5,t:"Hap",p:p1},
          {f:262,d:.5,t:"py&nbsp",p:p1},
          {f:294,d:1,t:"Birth",p:p1},
          {f:262,d:1,t:"day&nbsp",p:p1},
          {f:349,d:1,t:"To&nbsp",p:p1},
          {f:330,d:2,t:"You",p:p1},
          
          {f:262,d:.5,t:"Hap",p:p2},
          {f:262,d:.5,t:"py&nbsp",p:p2},
          {f:294,d:1,t:"Birth",p:p2},
          {f:262,d:1,t:"day&nbsp",p:p2},
          {f:392,d:1,t:"To&nbsp;",p:p2},
          {f:349,d:2,t:"You",p:p2},
          
          {f:262,d:.5,t:"Hap",p:p3},
          {f:262,d:.5,t:"py&nbsp;",p:p3},
          {f:523,d:1,t:"Birth",p:p3},
          {f:440,d:1,t:"day&nbsp",p:p3},
          {f:349,d:1,t:"Dear&nbsp;",p:p3},
          {f:330,d:1,t:"{Name}",p:p3},
          {f:294,d:2,t:"",p:p3},
          
          {f:466,d:.5,t:"Hap",p:p4},
          {f:466,d:.5,t:"py&nbsp",p:p4},
          {f:440,d:1,t:"Birth",p:p4},
          {f:349,d:1,t:"day&nbsp",p:p4},
          {f:392,d:1,t:"To&nbsp",p:p4},
          {f:349,d:2,t:"You",p:p4}
        ];
        
        const inputSpeed = document.getElementById('inputSpeed');
        let speed = parseFloat(inputSpeed.value);
        inputSpeed.oninput = () => speed = parseFloat(inputSpeed.value);

        const playNote = (frequency, duration) => {
          const oscillator = audioCtx.createOscillator();
          oscillator.type = 'square';
          oscillator.frequency.value = frequency;
          
          const gainNode = audioCtx.createGain();
          gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
          gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + duration * speed * 0.9);
          
          oscillator.connect(gainNode).connect(audioCtx.destination);
          oscillator.start(audioCtx.currentTime);
          oscillator.stop(audioCtx.currentTime + duration * speed);
        };

        const playNextNote = (i) => {
          if (i < notes.length) {
            const note = notes[i];
            playNote(note.f, note.d);
            
            const span = document.createElement('span');
            span.innerHTML = note.t;
            span.classList.add('jump');
            note.p.appendChild(span);

            setTimeout(() => {
              playNextNote(i + 1);
            }, note.d * speed * 1000);
          }
        };

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let cw = canvas.width = window.innerWidth;
        let ch = canvas.height = window.innerHeight;
        window.onresize = () => {
          cw = canvas.width = window.innerWidth;
          ch = canvas.height = window.innerHeight;
        };

        const colors = ['#f99', '#ff9', '#9f9', '#9ff', '#f9f'];

        class Particle {
          constructor() {
            this.x = Math.random() * cw;
            this.y = ch + 20;
            this.r = 5 + ~~(Math.random() * 20);
            this.l = 3 + ~~(Math.random() * 2);
            this.a = 2 * Math.PI / this.l;
            this.rot = Math.random() * Math.PI;
            this.speed = .05 + Math.random() / 2;
            this.rotSpeed = 0.005 + Math.random() * .005;
            this.color = colors[~~(Math.random() * colors.length)];
          }
          update() {
            if (this.y < -this.r) {
              this.y = ch + this.r;
              this.x = Math.random() * cw;
            }
            this.y -= this.speed;
            this.rot += this.rotSpeed;
          }
          draw() {
            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.rotate(this.rot);
            ctx.beginPath();
            for (let i = 0; i < this.l; i++) {
              let x = this.r * Math.cos(this.a * i);
              let y = this.r * Math.sin(this.a * i);
              ctx.lineTo(x, y);
            }
            ctx.closePath();
            ctx.lineWidth = 4;
            ctx.strokeStyle = this.color;
            ctx.stroke();
            ctx.restore();
          }
        }

        let particles = [];
        for (let i = 0; i < 20; i++) {
          let p = new Particle();
          particles.push(p);
        }

        const animate = () => {
          ctx.clearRect(0, 0, cw, ch);
          particles.forEach(p => {
            p.update();
            p.draw();
          });
          requestAnimationFrame(animate);
        };

        // Function untuk memulai musik dan visualizer
        const startMusic = () => {
            audioCtx.resume().then(() => {
                const pleaseClick = document.getElementById('pleaseClick');
                if (pleaseClick) pleaseClick.remove();
                animate();
                playNextNote(0);
            });
        };


        // =======================================================
        // 2. BIRTHDAY ANIMATION SCRIPT
        // (Isi konten script.js harus dimasukkan sepenuhnya di sini)
        // =======================================================
        const {
            gsap,
            gsap: { to, timeline, set, delayedCall },
            Splitting } =
        window;

        Splitting();

        const BTN = document.querySelector('.birthday-button__button');
        const SOUNDS = {
            CHEER: new Audio(
            'https://s3-us-west-2.amazonaws.com/s.cdpn.io/605876/cheer.mp3'),

            MATCH: new Audio(
            'https://s3-us-west-2.amazonaws.com/s.cdpn.io/605876/match-strike-trimmed.mp3'),

            TUNE: new Audio(
            'https://s3-us-west-2.amazonaws.com/s.cdpn.io/605876/happy-birthday-trimmed.mp3'),

            ON: new Audio('https://assets.codepen.io/605876/switch-on.mp3'),
            BLOW: new Audio(
            'https://s3-us-west-2.amazonaws.com/s.cdpn.io/605876/blow-out.mp3'),

            POP: new Audio(
            'https://s3-us-west-2.amazonaws.com/s.cdpn.io/605876/pop-trimmed.mp3'),

            HORN: new Audio(
            'https://s3-us-west-2.amazonaws.com/s.cdpn.io/605876/horn.mp3') };

        const EYES = document.querySelector('.cake__eyes');
        const TEXT = document.querySelector('.birthday-button__text');
        const CANDLE_CONTAINER = document.querySelector('.cake__candles');

        const LOOPS = 3;
        const LIGHTNESS_MIN = 20;
        const LIGHTNESS_MAX = 70;

        const RESET = () => {
            set('.char', { '--hue': () => Math.random() * 360, '--char-sat': 0, '--char-light': 0 });
            set('body', { '--lightness': 50, '--flame': 0 });
            set([EYES, TEXT], { display: 'block' });
            CANDLE_CONTAINER.style.display = 'none';
        };

        const FROSTING_TL = () => timeline({ repeat: LOOPS * 2 - 1, yoyo: true }).
        to('body', { '--frosting-hue': '+=90', duration: 0.1 });

        const SPRINKLES_TL = () => timeline({ repeat: LOOPS * 2 - 1, yoyo: true }).
        to('.cake__sprinkle', { '--sprinkle-hue': '+=90', duration: 0.1 });

        const SPIN_TL = () => timeline().
        to('.birthday-button__cake', { rotate: 360 * LOOPS, duration: LOOPS * 0.5, ease: 'none' });

        const SHAKE_TL = () => timeline({
            repeat: LOOPS * 4,
            yoyo: true,
            defaults: { duration: 0.1 } }).

        to('.birthday-button__cake', { x: 5 }).
        to('.birthday-button__cake', { x: -5 });

        const FLAME_TL = () => timeline({ repeat: LOOPS * 2, yoyo: true, defaults: { duration: 0.5 } }).
        to('.candle__flame-outer', { fill: '#edca1d', duration: 0.25 }).
        to('.candle__flame-outer', { fill: '#ff711f', duration: 0.25 });

        const LIGHTS_OUT = () => timeline({
            onStart: () => SOUNDS.BLOW.play(),
            onComplete: () => {
                SOUNDS.CHEER.play();
                SOUNDS.POP.play();
            } }).
        set([EYES, TEXT], { display: 'none' }).
        set(CANDLE_CONTAINER, { display: 'block' }).
        to('.birthday-button__text', { opacity: 0, duration: 0.05 }, 0).
        to('body', {
            '--lightness': LIGHTNESS_MIN,
            duration: 0.5,
            onStart: () => set('body', { '--flame': 1 }) }).

        to('body', { '--flame': 0, duration: 0.1, onComplete: () => SOUNDS.TUNE.play() }).
        to('body', { '--lightness': LIGHTNESS_MAX, duration: 0.25 }, '>-0.5').
        to('body', {
            '--lightness': LIGHTNESS_MIN,
            duration: 0.5,
            repeat: LOOPS - 1,
            yoyo: true }).

        to('.char', { '--char-sat': 70, '--char-light': 65, duration: 0.2 }, '>-0.5');

        const MASTER_TL = timeline({
            onStart: () => {
                SOUNDS.ON.play();
            },
            onComplete: () => {
                delayedCall(2, RESET);
                BTN.removeAttribute('disabled');
            },
            paused: true }).

        set('.birthday-button__cake', { display: 'block' }).
        to('.birthday-button', {
            onStart: () => SOUNDS.CHEER.play(),
            scale: 1,
            duration: 0.2 }).

        to('.char', { '--char-sat': 70, '--char-light': 65, duration: 0.2 }, 0).
        to('.char', {
            onStart: () => SOUNDS.HORN.play(),
            delay: 0.75,
            y: () => gsap.utils.random(-100, -200),
            x: () => gsap.utils.random(-50, 50),
            duration: () => gsap.utils.random(0.5, 1) }).

        to('.char', { opacity: 0, duration: 0.25 }, '>-0.5').
        add(FROSTING_TL()).
        add(SPRINKLES_TL()).
        add(SPIN_TL()).
        add(SHAKE_TL()).
        add(FLAME_TL(), 'FLAME_ON').
        add(LIGHTS_OUT(), 'LIGHTS_OUT');

        SOUNDS.TUNE.onended = SOUNDS.MATCH.onended = () => MASTER_TL.play();
        MASTER_TL.addPause('FLAME_ON', () => SOUNDS.MATCH.play());
        MASTER_TL.addPause('LIGHTS_OUT', () => SOUNDS.TUNE.play());

        // SINGLE TRIGGER FOR BOTH ACTIONS
        BTN.addEventListener('click', () => {
            BTN.setAttribute('disabled', true);
            
            // 1. Start Music and Visualizer
            startMusic();
            
            // 2. Start Animation
            MASTER_TL.restart(true);
        });

        // Initialize animation to reset state
        RESET();
        
    </script>
</body>
</html>
